[返回目录](/README.md)

第五部 阿修罗，星移

![第五部 阿修罗，星移](/ig/5.jpg)


指针
===========================

概念
----------

- `指针类型`的变量：

  只存`地址`。

  64位系统时的指针类型，占8个字节；

  32位系统时的指针类型，占4个字节；

- 指针类型做`全局变量`时

  因为普通变量 word 的地址，是在编译链接时就能确定的，而不需要到`运行时`才知道。所以 &word 是`常量表达式`。

  如

  ```c
  // 全局（char *型 的指针类型）
  char *pword = &word;        // 是没有问题的。因为编译时 &word 已是常量（地址）。
  /* 以上全是 定义声明 */
  ```

- `指针类型`，再`加上 *号`来表达式，则是一个`左值`！：

  例如

  ```c
  int j;
  int *pi = &j;
  /* 以上全是 定义声明 */

  /* 以下全是 运算！： */
  *pi = *pi + 111;  // 即 j + 111（指针类型 加*号 来运算时，可做`左值`！）

  int *pai;     // 新定义一个指针类型（或 int *pai = pi; 也一样，注意*星号的用法）
  pai = pi;     // 注意，pi 没有加*号 来运算！！所以pi依然是一个`指针类型`，并`非左值`！
  ```

- 确保对指针类型的变量，都要初始化：

  至少赋值一个 NULL（这就是`空指针`）。否则就会成为`野指针`！大概率的导致各种难以察觉的`数据`错误。

  ```c
  #include <stddef.h>

  int main(void)
  {
  	int *p = NULL;   // （这就是`空指针`）OS会确保不会在 NULL 即地址0 的附近，保存任何数据！
  	...
  	*p = 0;
  	...
  }
  ```

  - NULL（这就是`空指针`），在C标准库的头文件 stddef.h 中定义：

    ```c
    #define NULL ((void *)0)          // void *类型，是C标准中规定的`通用指针`，用于各种指针类型转换。
    ```

    void *指针，与其它类型的指针之间可以`隐式转换`，而不必用`类型转换运算符`()。

    举个例子：

      ```c
      void func(void *pv)     // void * 此处就可对 各指针类型 进行 隐式转换
      {
      	/* *pv = 'A' is illegal */
      	char *pchar = pv;
      	*pchar = 'A';
      }

      int main(void)
      {
      	char c;
      	func(&c);
        
      	printf("%c\n", c);
        ...
      }
      ```
